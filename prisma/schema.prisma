generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Roles {
  id_rol      Int           @id @default(autoincrement())
  nombre      String        @unique @db.VarChar(100)
  descripcion String?       @db.VarChar(255)
  usuarios    Usuarios[]
  permisos    RolPermisos[]

  @@map("Roles")
}

model Permisos {
  id_permiso  Int           @id @default(autoincrement())
  nombre      String        @unique @db.VarChar(100)
  descripcion String?       @db.VarChar(255)
  roles       RolPermisos[]
  usuarios    UsuarioPermisos[]

  @@map("Permisos")
}

model Usuarios {
  id_usuario   Int        @id @default(autoincrement())
  nombre       String     @db.VarChar(100)
  email        String     @unique @db.VarChar(100)
  passwordHash String     @map("contrase√±a") @db.VarChar(255)
  id_rol       Int
  id_departamento Int?
  rol          Roles      @relation(fields: [id_rol], references: [id_rol])
  departamento Departamentos? @relation(fields: [id_departamento], references: [id_departamento])
  permisos     UsuarioPermisos[]

  @@map("Usuarios")
}

model RolPermisos {
  id_rol     Int
  id_permiso Int
  rol        Roles    @relation(fields: [id_rol], references: [id_rol])
  permiso    Permisos @relation(fields: [id_permiso], references: [id_permiso])

  @@id([id_rol, id_permiso])
  @@map("RolPermisos")
}

model Paises {
  id_pais   Int       @id @default(autoincrement())
  nombre    String    @unique @db.VarChar(100)
  regiones  Regiones[]
  permisos  UsuarioPermisos[]

  @@map("Paises")
}

model Regiones {
  id_region  Int             @id @default(autoincrement())
  nombre     String          @db.VarChar(100)
  id_pais    Int
  pais       Paises          @relation(fields: [id_pais], references: [id_pais])
  departamentos Departamentos[]
  permisos   UsuarioPermisos[]

  @@map("Regiones")
}

model Departamentos {
  id_departamento Int              @id @default(autoincrement())
  nombre          String           @db.VarChar(100)
  id_region       Int
  region          Regiones         @relation(fields: [id_region], references: [id_region])
  usuarios        Usuarios[]
  permisos        UsuarioPermisos[]

  @@map("Departamentos")
}

model UsuarioPermisos {
  id              Int             @id @default(autoincrement())
  id_usuario      Int
  id_permiso      Int
  id_pais         Int?
  id_region       Int?
  id_departamento Int?
  usuario         Usuarios        @relation(fields: [id_usuario], references: [id_usuario])
  permiso         Permisos        @relation(fields: [id_permiso], references: [id_permiso])
  pais            Paises?         @relation(fields: [id_pais], references: [id_pais])
  region          Regiones?       @relation(fields: [id_region], references: [id_region])
  departamento    Departamentos?  @relation(fields: [id_departamento], references: [id_departamento])

  @@unique([id_usuario, id_permiso, id_pais, id_region, id_departamento], name: "uq_usuario_permiso_localizacion")
  @@index([id_usuario])
  @@index([id_permiso])
  @@map("UsuarioPermisos")
}
